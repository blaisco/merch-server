<% description truncate(@product.description, :length => 160) %>

<div class="row">
  <div class="span11">
    <div id="breadcrumb"><%# breadcrumb(@product.product_type) %></div>
    <h1><%= title @product.name %><%= ' '.html_safe + link_to('(edit)', edit_product_path(@product)) if current_user %></h1>
    <div class="row">
      <div class="span11">
        <div id="item-image">
          <% if @product.images.blank? %>
            <%# TODO: Get a default image_tag for a no-image image %>
            <%= image_tag nil %>
          <% else %>
            <%= link_to(
                image_tag(@product.images.first.data.url(:medium), :alt => "Main product image"), 
              @product.images.first.data.url) %>
          <% end %>
        </div>
        <div id="item-thumbs">
          <% if @product.images.size == 1 %>
            <% @product.images.each do |img| %>
              <%= image_tag img.data.url(:thumb), :alt => "Product thumbnail" %>
            <% end %>
          <% end %>
        </div>
        
        <div class="row">
          <div id="item-summary" class="span9"><%= simple_format(truncate(@product.description, :length => 250)) %></div>
        </div>
        
        <div class="row">
          <div id="item-summary" class="span11">[insert Facebook comments here]</div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="span5">
    <div class="item-price">
      <div class="item-amount"><%= price(@product) %></div>
      <div class="item-actions"><a href="<%= @product.url %>" class="btn large success">Check it out &raquo;</a></div>
    </div>
    
    <div class="sidebar">
      <%= render :partial => "related_products_sidebar", :locals => { 
          :headline => "Sold by %s",
          :has_products => @product.merchant, 
          :exclude => @product } 
      %>
      
      <% unless @product.merchandisable.nil? %>
      <%= render :partial => "related_products_sidebar", :locals => { 
          :headline => "Other %s merch",
          :has_products => @product.merchandisable, 
          :exclude => @product } 
      %>
      <% end %>
      
      <% @product.product_types.each do |type| %>
        <%= render :partial => "related_products_sidebar", :locals => { 
            :headline => "More %s",
            :has_products => type, 
            :exclude => @product } 
        %>
      <% end %>
    </div>
    
    <div class="item-price">
      <div class="item-amount"><%= price(@product) %></div>
      <div class="item-actions"><a href="<%= @product.url %>" class="btn large success">Check it out &raquo;</a></div>
    </div>
  </div>
</div>
